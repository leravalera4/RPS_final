<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wallet Status Test</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #1a1a1a;
      color: #0f0;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      background: #2a2a2a;
      border-radius: 8px;
    }
    .success { color: #0f0; }
    .error { color: #f00; }
    .warning { color: #ff0; }
    button {
      padding: 10px 20px;
      margin: 5px;
      background: #0f0;
      color: #000;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #0a0;
    }
    pre {
      background: #000;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>üîç Wallet Status Test</h1>
  
  <div class="section">
    <h2>1. Check Privy Status</h2>
    <button onclick="checkPrivyStatus()">Check Status</button>
    <pre id="privy-status"></pre>
  </div>
  
  <div class="section">
    <h2>2. Check Wallets</h2>
    <button onclick="checkWallets()">Check Wallets</button>
    <pre id="wallets"></pre>
  </div>
  
  <div class="section">
    <h2>3. Test Transaction Signing</h2>
    <button onclick="testSigning()">Test Signing</button>
    <pre id="signing-result"></pre>
  </div>
  
  <div class="section">
    <h2>4. Full Test</h2>
    <button onclick="runFullTest()">Run Full Test</button>
    <pre id="full-test-result"></pre>
  </div>

  <script>
    function log(elementId, message, type = 'info') {
      const element = document.getElementById(elementId)
      const timestamp = new Date().toLocaleTimeString()
      const prefix = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'
      element.textContent += `[${timestamp}] ${prefix} ${message}\n`
      element.scrollTop = element.scrollHeight
    }

    function clearLog(elementId) {
      document.getElementById(elementId).textContent = ''
    }

    async function checkPrivyStatus() {
      clearLog('privy-status')
      log('privy-status', 'Checking Privy status...')
      
      try {
        // Check if Privy is loaded
        if (typeof window.privy === 'undefined' && typeof window.__PRIVY_WALLETS__ === 'undefined') {
          log('privy-status', 'Privy not found in window object', 'error')
          log('privy-status', 'Available window properties:', 'info')
          Object.keys(window).filter(k => k.includes('privy') || k.includes('PRIVY')).forEach(k => {
            log('privy-status', `  - ${k}`, 'info')
          })
          return
        }
        
        log('privy-status', 'Privy found!', 'success')
        
        // Try to get user
        if (window.privy && window.privy.user) {
          log('privy-status', `User ID: ${window.privy.user.id}`, 'success')
        }
        
        // Try to get wallets
        if (window.privy && window.privy.wallets) {
          log('privy-status', `Wallets: ${window.privy.wallets.length}`, 'success')
        }
        
      } catch (error) {
        log('privy-status', `Error: ${error.message}`, 'error')
      }
    }

    async function checkWallets() {
      clearLog('wallets')
      log('wallets', 'Checking wallets...')
      
      try {
        // Access window.privy or try different methods
        let wallets = []
        
        if (window.privy && window.privy.wallets) {
          wallets = window.privy.wallets
        }
        
        if (wallets.length === 0) {
          log('wallets', 'No wallets found', 'warning')
          log('wallets', 'Make sure you are logged in to the app', 'info')
          return
        }
        
        log('wallets', `Found ${wallets.length} wallet(s):`, 'success')
        
        wallets.forEach((wallet, i) => {
          log('wallets', `Wallet ${i + 1}:`, 'info')
          log('wallets', `  Address: ${wallet.address?.substring(0, 20)}...`, 'info')
          log('wallets', `  Type: ${wallet.walletClientType}`, 'info')
          log('wallets', `  Chain: ${wallet.chainType || 'unknown'}`, 'info')
          log('wallets', `  Is Solana: ${wallet.address && !wallet.address.startsWith('0x') ? 'Yes' : 'No'}`, wallet.address && !wallet.address.startsWith('0x') ? 'success' : 'warning')
          log('wallets', `  Has signTransaction: ${!!wallet.signTransaction}`, wallet.signTransaction ? 'success' : 'error')
        })
        
      } catch (error) {
        log('wallets', `Error: ${error.message}`, 'error')
      }
    }

    async function testSigning() {
      clearLog('signing-result')
      log('signing-result', 'Testing transaction signing...')
      
      try {
        // Get Solana wallet
        let wallets = []
        if (window.privy && window.privy.wallets) {
          wallets = window.privy.wallets
        }
        
        const solanaWallet = wallets.find(w => w.address && !w.address.startsWith('0x'))
        
        if (!solanaWallet) {
          log('signing-result', 'No Solana wallet found', 'error')
          return
        }
        
        log('signing-result', `Found Solana wallet: ${solanaWallet.address.substring(0, 12)}...`, 'success')
        
        if (!solanaWallet.signTransaction) {
          log('signing-result', 'Wallet does not have signTransaction method', 'error')
          log('signing-result', 'Available methods:', 'info')
          Object.keys(solanaWallet).forEach(method => {
            log('signing-result', `  - ${method}`, 'info')
          })
          return
        }
        
        log('signing-result', 'Wallet has signTransaction method!', 'success')
        log('signing-result', '‚úÖ Signing capability confirmed', 'success')
        
      } catch (error) {
        log('signing-result', `Error: ${error.message}`, 'error')
      }
    }

    async function runFullTest() {
      clearLog('full-test-result')
      log('full-test-result', 'Running full test suite...', 'info')
      
      await new Promise(resolve => setTimeout(resolve, 500))
      await checkPrivyStatus()
      
      await new Promise(resolve => setTimeout(resolve, 500))
      await checkWallets()
      
      await new Promise(resolve => setTimeout(resolve, 500))
      await testSigning()
      
      log('full-test-result', '', 'info')
      log('full-test-result', '====================', 'info')
      log('full-test-result', 'Full test completed!', 'success')
      log('full-test-result', '====================', 'info')
    }

    // Auto-run on load
    window.addEventListener('load', () => {
      log('privy-status', 'Page loaded. Click buttons to test.', 'info')
    })
  </script>
</body>
</html>
